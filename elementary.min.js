(function(win){var elementary={};win.elementary=elementary;elementary.update=function(){};var doc=win.document,docElem=doc.documentElement,mediastyles=[],elements=[],cqIndex=0,rules=[],appendedEls=[],parsedSheets={},resizeThrottle=30,head=doc.getElementsByTagName("head")[0]||docElem,base=doc.getElementsByTagName("base")[0],links=head.getElementsByTagName("link"),requestQueue=[],hasClass=function(elem,className){return(new RegExp(" "+className+" ")).test(" "+elem.className+" ")},addClass=function(elem,
className){if(!hasClass(elem,className))elem.className+=" "+className},ripCSS=function(){for(var i=0;i<links.length;i++){var sheet=links[i],href=sheet.href,media=sheet.media,isCSS=sheet.rel&&sheet.rel.toLowerCase()==="stylesheet";if(!!href&&isCSS&&!parsedSheets[href])if(sheet.styleSheet&&sheet.styleSheet.rawCssText){translate(sheet.styleSheet.rawCssText,href,media);parsedSheets[href]=true}else if(!/^([a-zA-Z:]*\/\/)/.test(href)&&!base||href.replace(RegExp.$1,"").split("/")[0]===win.location.host)requestQueue.push({href:href,
media:media})}makeRequests()},makeRequests=function(){if(requestQueue.length){var thisRequest=requestQueue.shift();ajax(thisRequest.href,function(styles){translate(styles,thisRequest.href,thisRequest.media);parsedSheets[thisRequest.href]=true;win.setTimeout(function(){makeRequests()},0)})}},translate=function(styles,href,media){var qs=styles.match(/@element[^\{]+\{([^\{\}]*\{[^\}\{]*\})+/gi),ql=qs&&qs.length||0;href=href.substring(0,href.lastIndexOf("/"));var repUrls=function(css){return css.replace(/(url\()['"]?([^\/\)'"][^:\)'"]+)['"]?(\))/g,
"$1"+href+"$2$3")},useMedia=!ql&&media;if(href.length)href+="/";if(useMedia)ql=1;for(var i=0;i<ql;i++){var fullq,thisq,eachq,eql;if(useMedia){fullq=media;rules.push(repUrls(styles))}else{fullq=qs[i].match(/@element *([^\{]+)\{([\S\s]+?)$/)&&RegExp.$1;rules.push(RegExp.$2&&repUrls(RegExp.$2))}eachq=fullq.split(",");eql=eachq.length;for(var j=0;j<eql;j++){thisq=eachq[j];mediastyles.push({selector:thisq.split("]")[0].split("[")[1],media:thisq.split("]")[1].split("(")[0].match(/(only\s+)?([a-zA-Z]+)\s?/)&&
RegExp.$2||"all",rules:rules.length-1,hasquery:thisq.indexOf("(")>-1,minw:thisq.match(/\(\s*min\-width:\s*(\s*[0-9\.]+)(px|em)\s*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||""),maxw:thisq.match(/\(\s*max\-width:\s*(\s*[0-9\.]+)(px|em)\s*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||"")})}}applyMedia()},lastCall,resizeDefer,getEmValue=function(){var ret,div=doc.createElement("div"),body=doc.body,fakeUsed=false;div.style.cssText="position:absolute;font-size:1em;width:1em";if(!body){body=fakeUsed=doc.createElement("body");
body.style.background="none"}body.appendChild(div);docElem.insertBefore(body,docElem.firstChild);ret=div.offsetWidth;if(fakeUsed)docElem.removeChild(body);else body.removeChild(div);ret=eminpx=parseFloat(ret);return ret},eminpx,applyMedia=function(fromResize){var name="clientWidth",docElemProp=docElem[name],currWidth=doc.compatMode==="CSS1Compat"&&docElemProp||doc.body[name]||docElemProp,styleBlocks={},lastLink=links[links.length-1],now=(new Date).getTime();if(fromResize&&lastCall&&now-lastCall<resizeThrottle){win.clearTimeout(resizeDefer);
resizeDefer=win.setTimeout(applyMedia,resizeThrottle);return}else lastCall=now;cqIndex=0;for(var i in mediastyles)if(mediastyles.hasOwnProperty(i)){var thisstyle=mediastyles[i],min=thisstyle.minw,max=thisstyle.maxw,minnull=min===null,maxnull=max===null,em="em",elements=doc.querySelectorAll(thisstyle.selector),cqid="__cq"+cqIndex,hasmatch=false;cqIndex++;if(!!min)min=parseFloat(min)*(min.indexOf(em)>-1?eminpx||getEmValue():1);if(!!max)max=parseFloat(max)*(max.indexOf(em)>-1?eminpx||getEmValue():1);
for(var l=0;l<elements.length;l++){if(elements[l].getAttribute("data-class-cache")==null)elements[l].setAttribute("data-class-cache",elements[l].getAttribute("class")!=null?elements[l].getAttribute("class"):"");if(i==0)elements[l].setAttribute("class",elements[l].getAttribute("data-class-cache"));var elementWidth=elements[l].offsetWidth;if(!thisstyle.hasquery||(!minnull||!maxnull)&&(minnull||elementWidth>=min)&&(maxnull||elementWidth<=max)){addClass(elements[l],cqid);hasmatch=true}}if(hasmatch){if(!styleBlocks[thisstyle.media])styleBlocks[thisstyle.media]=
[];styleBlocks[thisstyle.media].push(rules[thisstyle.rules].replace(new RegExp(thisstyle.selector,"g"),"."+cqid))}}for(var j in appendedEls)if(appendedEls.hasOwnProperty(j))if(appendedEls[j]&&appendedEls[j].parentNode===head)head.removeChild(appendedEls[j]);for(var k in styleBlocks)if(styleBlocks.hasOwnProperty(k)){var ss=doc.createElement("style"),css=styleBlocks[k].join("\n");ss.type="text/css";ss.media=k;head.insertBefore(ss,lastLink.nextSibling);if(ss.styleSheet)ss.styleSheet.cssText=css;else ss.appendChild(doc.createTextNode(css));
appendedEls.push(ss)}},ajax=function(url,callback){var req=xmlHttp();if(!req)return;req.open("GET",url,true);req.onreadystatechange=function(){if(req.readyState!==4||req.status!==200&&req.status!==304)return;callback(req.responseText)};if(req.readyState===4)return;req.send(null)},xmlHttp=function(){var xmlhttpmethod=false;try{xmlhttpmethod=new win.XMLHttpRequest}catch(e){xmlhttpmethod=new win.ActiveXObject("Microsoft.XMLHTTP")}return function(){return xmlhttpmethod}}();ripCSS();elementary.update=
ripCSS;elementary.run=callMedia;function callMedia(){applyMedia(true)}if(win.addEventListener)win.addEventListener("resize",callMedia,false);else if(win.attachEvent)win.attachEvent("onresize",callMedia)})(this);
